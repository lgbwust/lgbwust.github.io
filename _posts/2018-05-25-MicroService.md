---
layout: post
title: 微服务简介（持续更新中）
categories: [java,微服务]
tags: code
---

> 为了更好的明天

## 什么微服务

**微服务是系统架构上的一种设计风格**， 它的主旨是将一个原本独立的**系统拆分成多个小型服务**，这些小型服务都在各自**独立的进程中运行**，服务之间通过基于HTTP的`RESTful API`进行通信协作。 被拆分成的每一个小型服务都围绕着系统中的某一项或一些耦合度较高的业务功能进行构建， 并且每个服务都维护着自身的数据存储、 业务开发、自动化测试案例以及独立部署机制。 由千有了轻量级的通信协作基础， 所以这些微服务可以使用**不同的语言**来编写。

## 微服务的挑战

- **运维：**在微服务架构中， 运维人员需要维护的进程数量会大大增加

- **接口一致性：**虽然我们拆分了服务， 但是业务逻辑上的依赖并不会消除， 只是从单体应用中的代码依赖变为了服务间的通信依赖。 而当我们对原有接口进行了一些
修改， 那么交互方也需要协调这样的改变来进行发布， 以保证接口的正确调用。 我们需要更完善的接口和版本管理， 或是严格地遵循开闭原则。

- **分布式的复杂性：**由于拆分后的各个微服务都是独立部署并运行在各自的进程内，它们只能通过通信来进行协作， 所以分布式环境的问题都将是微服务架构系统设计
时需要考虑的重要因素， 比如网络延迟、 分布式事务、 异步消息等。

## 微服务的特性

### 服务组件化

组件， 是 一个可以独立更换和升级的单元。在微服务架构中， 需要我们对服务进行组件化分解。 服务， 是 一种进程外的组件， 它通过 HTTP 等通信协议进行协作， 而不是像传统组件那样以嵌入的方式协同工作。 每一个服务都独立开发、 部署， 可以有效避免一个服务的修改引起整个系统的重新部署。

### 按业务组织团队

在实施微服务架构时，需要采用不同的团队分割方法。 由于每一个微服务都是针对特定业务的宽栈或是全栈实现， 既要负责数据的持久化存储， 又要负责用户的接口定义等各种跨专业领域的职能。 

### 做 “ 产品 ” 的态度

在实施微服务架构的团队中， 每个小团队都应该以做产品的方式， 对其产品的整个生命周期负责。 而不是以项目的模式，以完成开发与交付并将成果交接给维护者为最终目标。

### 智能端点与哑管道

在单体应用中， 组件间直接通过函数调用的方式进行交互协作。 而在微服务架构中，由于服务不在一个进程中， 组件间的通信模式发生了改变， 若仅仅将原本在进程内的方法调用改成 RPC 方式的调用， 会导致微服务之间产生烦琐的通信， 使得系统表现更为糟糕，所以， 我们需要更粗粒度的通信协议。

在微服务架构中， 通常会使用以下两种服务调用方式：
- 第一种， 使用 HTTP 的 RESTfl API 或轻量级的消息发送协议， 实现信息传递与服务调用的触发。
- 第二种， 通过在轻量级消息总线上传递消息， 类似 RabbitMQ 等 一些提供可靠异步交换的中间件。

### 去中心化治理

当我们采用集中化的架构治理方案时， 通常在技术平台上都会制定统一的标准， 但是每一种技术平台都有其短板， 这会导致在碰到短板时， 不得不花费大力气去解决， 并且可能因为其底层原因解决得不是很好， 最终成为系统的瓶颈。在实施微服务架构时， 通过采用轻量级的契约定义接口， 使得我们对于服务本身的具体技术平台不再那么敏感， 这样整个微服务架构系统中的各个组件就能针对其不同的业务特点选择不同的技术平台。

### 去中心化管理数据

我们在实施微服务架构时， 都希望让每一个**服务来管理其自有的数据库**， 这就是数据管理的去中心化。

虽然数据管理的去中心化可以让数据管理更加细致化， 通过采用更合适的技术可让数据存储和性能达到最优。 但是， 由于数据存储于不同的数据库实例中后， **数据一致性**也成为微服务架构中亟待解决的问题之一。 分布式事务本身的实现难度就非常大， 所以在微服务架构中， 我们更强调在各服务之间进行 “ 无事务 ” 的调用， 而对于数据一致性， 只要求数据在最后的处理状态是一致的即可；若在过程中发现错误， 通过补偿机制来进行处理，使得错误数据能够达到最终的一致性。

### 基础设施自动化

近年来云计算服务与容器化技术的不断成熟， 运维基础设施的工作变得越来越容易。但是， 当我们实施微服务架构时， 数据库、 应用程序的个头虽然都变小了， 但是因为拆分的原因， 数量成倍增长。 这使得运维人员需要关注的内容也成倍增长， 并且操作性任务也会成倍增长， 这些问题若没有得到妥善解决， 必将成为运维人员的噩梦。所以， 在微服务架构中， 务必从 一开始就构建起 “ 待续交付 ” 平台来支撑整个实施过程， 该平台需要两大内容， 缺一不可。
- **自动化测试：**每次部署前的强心剂， 尽可能地获得对正在运行的软件的信心。
- **自动化部署：**解放烦琐枯燥的重复操作以及对多环境的配置管理。

### 容错设计

在单体应用中， 一般不存在单个组件故障而其他部件还在运行的情况， 通常是一挂全挂。 而在微服务架构中， 由于服务都运行在独立的进程中， 所以存在部分服务出现故障，而其他服务正常运行的情况。 比如， 当正常运作的服务B调用到故障服务A时， 因故障服务 A 没有返回， 线程挂起开始等待， 直到超时才能释放， 而此时若触发服务 B 调用服务 A的请求来自服务 C, 而服务 C 频繁调用服务 B 时， 由千其依赖服务 A, 大量线程被挂起等待， 最后导致服务A也不能正常服务， 这时就会出现故障的荽延。所以， 在微服务架构中，**快速检测出故障源并尽可能地自动恢复服务是必须被设计和考虑的**。 通常， 我们都希望在每个服务中实现监控和日志记录的组件， 比如**服务状态、 断路器状态、 吞吐量 、 网络延迟**等关键数据的仪表盘等。

### 演进式设计

通过上面的几点特征， 我们已经能够体会到， 要实施 一个完美的微服务架构， 需要考虑的设计与成本并不小， 对千没有足够经验的团队来说， 甚至要比单体应用付出更多的代价。所以， 在很多情况下， 架构师都会以**演进的方式进行系统的构建**。 在初期， 以单体系统的方式来设计和实施， 一方面系统体量初期并不会很大， 构建和维护成本都不高。 另一方面， 初期的核心业务在后期通常也不会发生巨大的改变。 随着系统的发展或者业务的需要， 架构师会将一些经常变动或是有一定时间效应的内容进行微服务处理， 并逐渐将原来在单体系统中多变的模块逐步拆分出来， 而稳定不太变化的模块就形成一个核心微服务存在于整个架构之中。

## Spring Cloud
